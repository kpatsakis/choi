tsize_t t2p_write_pdf_string(char* pdfstr, TIFF* output){

	tsize_t written=0;
	uint32 i=0;
	char buffer[5];
	uint32 len=0;
	
	len=strlen(pdfstr);
	written += TIFFWriteFile(output, (tdata_t) "(", 1);
	for (i=0;i<len;i++){
		if((pdfstr[i]&0x80) || (pdfstr[i]==127) || (pdfstr[i]<32)){
			sprintf(buffer, "\\%.3o", pdfstr[i]);
			written += TIFFWriteFile(output, (tdata_t) buffer, 4);
		} else {
			switch (pdfstr[i]){
				case 0x08:
					written += TIFFWriteFile(output, (tdata_t) "\\b", 2);
					break;
				case 0x09:
					written += TIFFWriteFile(output, (tdata_t) "\\t", 2);
					break;
				case 0x0A:
					written += TIFFWriteFile(output, (tdata_t) "\\n", 2);
					break;
				case 0x0C:
					written += TIFFWriteFile(output, (tdata_t) "\\f", 2);
					break;
				case 0x0D:
					written += TIFFWriteFile(output, (tdata_t) "\\r", 2);
					break;
				case 0x28:
					written += TIFFWriteFile(output, (tdata_t) "\\(", 2);
					break;
				case 0x29:
					written += TIFFWriteFile(output, (tdata_t) "\\)", 2);
					break;
				case 0x5C:
					written += TIFFWriteFile(output, (tdata_t) "\\\\", 2);
					break;
				default:
					written += TIFFWriteFile(output, (tdata_t) &pdfstr[i], 1);
			}
		}
	}
	written += TIFFWriteFile(output, (tdata_t) ") ", 1);

	return(written);
}
